<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>space_voyage</title>

<style>
/* ===== 기본 ===== */
html,body{
  margin:0; height:100%;
  background:#111;
}
body{
  display:grid;
  place-items:center;
  overflow:hidden;
  font-family: system-ui, Apple SD Gothic Neo, sans-serif;
}

/* ===== 메인 스테이지 ===== */
.viewport{
  width:100vw;
  height:100vh;
  display:grid;
  place-items:center;
}
.stage{
  position:relative;
  transform-origin: top left;
}
.bg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  user-select:none;
  pointer-events:none;
}
.overlay{
  position:absolute;
  inset:0;
}

/* 클릭 영역 */
.hit{
  position:absolute;
  background:rgba(255,255,255,0);
  border:0;
  cursor:pointer;
}

/* ===== 로그 ===== */
.log{
  position:absolute;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:12px;
}
.line{
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  font-weight:700;
  color:rgba(0,0,0,.75);
  background:rgba(255,255,255,.55);
  border-radius:16px;
}

/* ===== 시트 모달 ===== */
.modal{
  position:fixed;
  inset:0;
  display:none;
  place-items:center;
  background:rgba(0,0,0,.65);
  z-index:999;
}
.modal.open{ display:grid; }

.sheetViewport{
  width:92vw;
  height:92vh;
  display:grid;
  place-items:center;
}
.sheetStage{
  position:relative;
  transform-origin: top left;
}
.sheetBg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  user-select:none;
  pointer-events:none;
}
.sheetInput{
  position:absolute;
  border:none;
  outline:none;
  background:transparent;
  color:#0b49ff;
  font-weight:800;
  font-size:64px;
  text-align:right;
}
.sheetName{
  text-align:center;
}

/* 디버그(F2) */
body.debug .hit{
  background:rgba(0,255,255,.2);
  outline:1px solid cyan;
}
</style>
</head>

<body>

<!-- ===== 메인 ===== -->
<div class="viewport">
  <div class="stage" id="stage">
    <img id="mainBg" class="bg" src="main.png">

    <div class="overlay">

      <!-- 왼쪽 스탠딩 -->
      <input class="hit" id="fileL" type="file" accept="image/*"
        style="left:165px;top:260px;width:400px;height:800px;opacity:0">
      <img id="standL"
        style="position:absolute;left:165px;top:260px;width:400px;height:800px;object-fit:cover;display:none">

      <!-- 오른쪽 스탠딩 -->
      <input class="hit" id="fileR" type="file" accept="image/*"
        style="left:1535px;top:260px;width:400px;height:800px;opacity:0">
      <img id="standR"
        style="position:absolute;left:1535px;top:260px;width:400px;height:800px;object-fit:cover;display:none">

      <!-- 이름 클릭 -->
      <button class="hit" id="nameL"
        style="left:255px;top:1079px;width:221px;height:92px"></button>
      <button class="hit" id="nameR"
        style="left:1625px;top:1079px;width:221px;height:92px"></button>

      <!-- 로그 -->
      <div class="log" id="log"
        style="left:640px;top:260px;width:820px;height:800px"></div>

      <!-- 항해 일수 -->
      <div id="dayText"
        style="position:absolute;left:929px;top:1152px;width:242px;height:36px;
               display:flex;align-items:center;justify-content:center;
               color:rgba(255,255,255,.55);font-size:24px;font-weight:700">
        항해 0일째
      </div>

      <!-- 다음 버튼 -->
      <button class="hit" id="next"
        style="left:1194px;top:1152px;width:36px;height:36px"></button>

    </div>
  </div>
</div>

<!-- ===== 시트 ===== -->
<div class="modal" id="modal">
  <div class="sheetViewport">
    <div class="sheetStage" id="sheetStage">
      <img id="sheetBg" class="sheetBg" src="sheet.png">

      <!-- 닫기 -->
      <button class="hit" id="close"
        style="left:930px;top:55px;width:70px;height:70px"></button>

      <!-- 이름 -->
      <input class="sheetInput sheetName" id="f_name"
        style="left:411px;top:79px;width:229px;height:95px">

      <!-- 능력치 -->
      <input class="sheetInput" id="f_str" style="left:654px;top:275px;width:121px;height:84px" value="0">
      <input class="sheetInput" id="f_con" style="left:654px;top:419px;width:121px;height:84px" value="0">
      <input class="sheetInput" id="f_int" style="left:654px;top:563px;width:121px;height:84px" value="0">
      <input class="sheetInput" id="f_luk" style="left:654px;top:707px;width:121px;height:84px" value="0">
      <input class="sheetInput" id="f_aff" style="left:654px;top:851px;width:121px;height:84px" value="0">
      <input class="sheetInput" id="f_san" style="left:654px;top:995px;width:121px;height:84px" value="0">
    </div>
  </div>
</div>

<script>
/* ===== 상태 ===== */
let day = 0;
let launched = false;
let editing = 'L';

const state = {
  ship:'우주선',
  L:{name:'왼쪽 캐릭터',aff:0,str:0},
  R:{name:'오른쪽 캐릭터',aff:0,str:0}
};

const $ = id=>document.getElementById(id);

/* ===== 스케일 ===== */
function fit(el,img){
  const w = img.naturalWidth;
  const h = img.naturalHeight;
  el.style.width = w+'px';
  el.style.height = h+'px';
  const s = Math.min(innerWidth/w, innerHeight/h);
  el.style.transform = `scale(${s})`;
}
$('mainBg').onload = ()=>fit($('stage'),$('mainBg'));
$('sheetBg').onload = ()=>{
  const img=$('sheetBg'),st=$('sheetStage');
  const s=Math.min(
    $('sheetViewport').clientWidth/img.naturalWidth,
    $('sheetViewport').clientHeight/img.naturalHeight
  );
  st.style.width=img.naturalWidth+'px';
  st.style.height=img.naturalHeight+'px';
  st.style.transform=`scale(${s})`;
};
addEventListener('resize',()=>{
  if(mainBg.naturalWidth)fit(stage,mainBg);
  if(sheetBg.naturalWidth)sheetBg.onload();
});

/* ===== 로그 ===== */
function push(t){
  const d=document.createElement('div');
  d.className='line';
  d.textContent=t;
  log.appendChild(d);
  while(log.children.length>15)log.firstChild.remove();
}
function step(){
  if(!launched){
    log.innerHTML='';
    push(`${state.L.name}님이 ${state.ship}에 탑승하였습니다.`);
    push(`${state.R.name}님이 ${state.ship}에 탑승하였습니다.`);
    push(`${state.ship}이 발사되었습니다.`);
    launched=true;
    day=1;
  }else{
    push(`${state.ship}의 항해가 계속됩니다.`);
    day++;
  }
  dayText.textContent=`항해 ${day}일째`;
}

/* ===== 이벤트 ===== */
next.onclick=step;

/* ===== 시트 ===== */
function openSheet(side){
  editing=side;
  modal.classList.add('open');
  f_name.value=state[side].name;
}
nameL.onclick=()=>openSheet('L');
nameR.onclick=()=>openSheet('R');
close.onclick=()=>modal.classList.remove('open');

f_name.onchange=()=>state[editing].name=f_name.value;

/* ===== 스탠딩 ===== */
function bindFile(input,img){
  input.onchange=e=>{
    const f=e.target.files[0];
    if(!f)return;
    img.src=URL.createObjectURL(f);
    img.style.display='block';
  };
}
bindFile(fileL,standL);
bindFile(fileR,standR);

/* 디버그 */
addEventListener('keydown',e=>{
  if(e.key==='F2')document.body.classList.toggle('debug');
});
</script>

</body>
</html>
